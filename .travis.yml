language: node_js
node_js:
- 8.9.3
# filter_secrets: false
matrix:
  include:
  - os: linux
    dist: ubuntu
  - os: osx
before_install:
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install libxkbfile-dev libsecret-1-dev;
  fi
script:
- scripts/build.sh
before_deploy:
- export TRAVIS_TAG="1.31.0-$TRAVIS_BUILD_NUMBER"
- echo "$TRAVIS_TAG" "$TRAVIS_COMMIT"
- git config --local user.name "$USER_NAME"
- git config --local user.email "$USER_EMAIL"
- git tag "$TRAVIS_TAG" "$TRAVIS_COMMIT"
deploy:
  provider: releases
  tag_name: $TRAVIS_TAG
  target_commitish: $TRAVIS_COMMIT
  name: $TRAVIS_TAG
  skip_cleanup: true
  api_key:
    secure: NwphYOyUCzt2/ppGnPZ5vWhudh3bsSwdTN0YxHa0EI9aGugbu+PUdvMX+7eoAtkf8Co6SfjeAJSORA+JvlpxfVok8ppk0nPEXTJbURJAcZONShRJBmEKf/gjjpXXMveM9sAXjANpWoW+mMxzUXUsH1WbKN2Nb0ZCAugcuRV15qDmEMeryJ2Nu0ZMZeYA8reMLGJ2lbW4z3YOm3w2w/xfzKPkK371Nl5jOGhvAS8xT9/BMO0Q9kNI5ReXYE1S9TJyDQ8yRFzJ3Ce5jB0eLDI9YpnOgSMf/VvbFqegaBmbQahRTSmveo3j/diKt8bh4XY+ygMIpsCWOswWehLVXYQwZWUvpiVqo/XCDoBwuumi0Apffsv5seryFj4LBpBbap+qng12ZvrKVC3MhuMrL4aBWEwXCKMFpLOd1joOsLuc9GTswp1o6oZIrRWzuznOrU/ingUlvOJ83ZHzdAEJod3c0Ya30VzxNRocZOnu5Ai/dOa1pBBxbauDy+so19/Qi3kyAnX0myy7BZlD5CyOQblnWnAN7eJlRu6/2lmt/Dx7QmmATFpFK/LebKUsunEIuT48oejkBMcOWc0jfeO7teMi6qP71OoJ50lxQBCgfpnPokmxpes2KeSteq2YAprS7jP+NBD2+XgJIII1+GYZl93FU3T01gtMOqvQQnNiBCXEivQ=
  file_glob: true
  prerelease: true
  file: packages/server/cli-*
  on:
    repo: codercom/code-server
    branch: master
